<topology id="myTopology">

    <var id="numFLPs" value="64" />
    <var id="numEPNs" value="64" />

    <property id="FLPSyncSamplerInputAddress" />
    <property id="FLPSyncSamplerOutputAddress" />
    <property id="EPNReceiverInputAddress" />
    <property id="EPNReceiverOutputAddress" />

    <declrequirement id="FLPSyncSamplerHost">
        <hostPattern type="wnname" value="sampler"/>
    </declrequirement>

    <declrequirement id="FLPSenderHost">
        <hostPattern type="wnname" value="flp(00|01|02|03)"/>
    </declrequirement>

    <declrequirement id="EPNReceiverHost">
        <hostPattern type="wnname" value="epn(00|01|02|03)"/>
    </declrequirement>

    <decltask id="flpSyncSampler">
        <exe reachable="true">/home/arybalch/alice/AliceO2/build/bin/flpSyncSampler --id flpSyncSampler --mq-config /home/arybalch/alice/AliceO2/build/bin/config/flp2epn-prototype-dds.json --log-color 0 --control dds --event-rate 100</exe>
        <requirement>FLPSyncSamplerHost</requirement>
        <properties>
            <id access="write">FLPSyncSamplerInputAddress</id>
            <id access="write">FLPSyncSamplerOutputAddress</id>
        </properties>
    </decltask>

    <decltask id="flpSender">
        <exe reachable="true">/home/arybalch/alice/AliceO2/build/bin/flpSender --id flp%taskIndex% --config-key flpSender --mq-config /home/arybalch/alice/AliceO2/build/bin/config/flp2epn-prototype-dds.json --log-color 0 --control dds --event-size 100000 --num-epns ${numEPNs} --test-mode 1</exe>
        <requirement>FLPSenderHost</requirement>
        <properties>
            <id access="read">FLPSyncSamplerOutputAddress</id>
            <id access="read">EPNReceiverInputAddress</id>
        </properties>
    </decltask>

    <decltask id="epnReceiver">
        <exe reachable="true">/home/arybalch/alice/AliceO2/build/bin/epnReceiver --id epn%taskIndex% --config-key epnReceiver --mq-config /home/arybalch/alice/AliceO2/build/bin/config/flp2epn-prototype-dds.json --log-color 0 --control dds --num-flps ${numFLPs} --test-mode 1</exe>
        <requirement>EPNReceiverHost</requirement>
        <properties>
            <id access="write">EPNReceiverInputAddress</id>
            <id access="read">FLPSyncSamplerInputAddress</id>
            <id access="write">EPNReceiverOutputAddress</id>
        </properties>
    </decltask>

    <main id="main">
        <task>flpSyncSampler</task>
        <group id="groupFLP" n="${numFLPs}">
            <task>flpSender</task>
        </group>
        <group id="groupEPN" n="${numEPNs}">
            <task>epnReceiver</task>
        </group>
    </main>
</topology>
